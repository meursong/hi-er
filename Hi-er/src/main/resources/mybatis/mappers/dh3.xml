<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mulcam.hier.dao.ProductListDAO">

	<select id="selectProductDate" resultType="ProductList" parameterType="ProductList">
		<![CDATA[
			select p.product_id, u.nickname, u.job, p.title, p.commission, avg(r.star_point)as avg_star_point, count(r.review_id)as review_count, p.createdAt from product p left join user u on u.user_id=p.seller_id left join review r on p.product_id=r.product_id group by p.product_id order by p.product_id desc limit #{paginationInfo.firstRecordIndex}, #{recordsPerPage};
		]]>
	</select>
	
		<select id="selectTotalCount" resultType="int">
		<![CDATA[
			select count(*) from product;
		]]>
	</select>

	<select id="selectProductReviewCount" resultType="ProductList" parameterType="ProductList">
		<![CDATA[
			select p.product_id, u.nickname, u.job, p.title, p.commission, avg(r.star_point)as avg_star_point, count(r.review_id)as review_count, p.createdAt from product p left join user u on u.user_id=p.seller_id left join review r on p.product_id=r.product_id group by p.product_id order by count(r.review_id) desc limit #{paginationInfo.firstRecordIndex}, #{recordsPerPage};
		]]>
	</select>

	<select id="selectProductStarPoint" resultType="ProductList" parameterType="ProductList">
		<![CDATA[
			select p.product_id, u.nickname, u.job, p.title, p.commission, avg(r.star_point)as avg_star_point, count(r.review_id)as review_count, p.createdAt from product p left join user u on u.user_id=p.seller_id left join review r on p.product_id=r.product_id group by p.product_id order by avg_star_point desc limit #{paginationInfo.firstRecordIndex}, #{recordsPerPage};
		]]>
	</select>
	
	
	
</mapper>

