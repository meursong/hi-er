<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layout}">


<section layout:fragment="contents">
	<div class="py-5">
		<div class="container">
			<div class="row">
				<!-- Main Content -->
				<aside class="col col-xl-3 order-xl-1 col-lg-12 order-lg-1 col-12">
					<div
						class="box mb-3 shadow-sm rounded bg-white profile-box text-center">
						<div class="py-4 px-3 border-bottom">
					<img class="img-fluid mt-2 rounded-circle" th:src="@{/upload/} + ${session.loginedUser.profile_image}" onerror="this.src='/images/user/default.jpg'" alt="Responsive image">
							<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.email }]]</h5>
							<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.name }]]</h5>
							<h5 class="font-weight-bold text-dark mb-1 mt-4"> [[${session.loginedUser.nickname }]]</h5>
						</div>
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.buyOrder}]]건</h6>
								<p class="mb-0 text-black-50 small">구매 건수</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.sellOrder}]]건</h6>
								<p class="mb-0 text-black-50 small">판매 건수</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.buySumOrder}]]원</h6>
								<p class="mb-0 text-black-50 small">구매 총가격</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.sellSumOrder}]]원</h6>
								<p class="mb-0 text-black-50 small">판매 총가격</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.clickLike}]]번</h6>
								<p class="mb-0 text-black-50 small">누른 좋아요</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.clickedLike}]]번</h6>
								<p class="mb-0 text-black-50 small">눌린 좋아요</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 p-3 overflow-hidden border-top border-right">
								<a class="font-weight-bold p-2 d-block" th:href="@{/logout}">
									로그아웃 </a>
							</div>
							<div class="col-6 p-3 overflow-hidden border-top">
								<a th:if=${session.loginedUser.type}!=2 class="font-weight-bold p-2 d-block" th:href="@{/mypage/4}">
									내정보수정 </a>
								<a th:if=${session.loginedUser.type}==2 class="font-weight-bold p-2 d-block" th:href="@{/mypage/5}">
									내정보수정 </a>	
							</div>
						</div>

					</div>
					<div class="box shadow-sm  rounded bg-white mb-3">
						<div class="box-title border-bottom p-3">
							<h6 class="m-0">Skills & Endorsements</h6>
						</div>
						<div class="box-body">
							<div
								class="d-flex align-items-center osahan-post-header p-3 border-bottom people-list">
								<div class="dropdown-list-image mr-3">
									<img class="rounded-circle" th:src="@{/images/l4.png}" alt="">
								</div>
								<div class="font-weight-bold">
									<div class="text-truncate">
										Character Concept <span class="badge badge-dark ml-1">1</span>
									</div>
									<div class="small text-muted">
										<span class="text-primary">You and 1 connection</span> have
										given endorsements for this skill
									</div>
								</div>
							</div>
							<div
								class="d-flex align-items-center osahan-post-header p-3 border-bottom people-list">
								<div class="dropdown-list-image mr-3">
									<img class="rounded-circle" th:src="@{/images/l8.png}" alt="">
								</div>
								<div class="font-weight-bold">
									<div class="text-truncate">
										Digital Painting <span class="badge badge-danger ml-1">6</span>
									</div>
									<div class="small text-muted">
										<span class="text-primary">Ask</span> has given an endorsement
										for this skill
									</div>
								</div>
							</div>
							<div
								class="d-flex align-items-center osahan-post-header p-3 people-list">
								<div class="dropdown-list-image mr-3">
									<img class="rounded-circle" th:src="@{/images/l5.png}" alt="">
								</div>
								<div class="font-weight-bold">
									<div class="text-truncate">
										Adobe Photoshop <span class="badge badge-info ml-1">3</span>
									</div>
									<div class="small text-muted">
										<span class="text-primary">Julia Cox</span> has given an
										endorsement for this skill
									</div>
								</div>
							</div>
						</div>
					</div>
					<div
						class="box shadow-sm mb-3 rounded bg-white ads-box text-center overflow-hidden">
						<img th:src="@{/images/job1.png}" class="img-fluid"
							alt="Responsive image">
						<div class="p-3 border-bottom">
							<h6 class="font-weight-bold text-dark">Osahan Solutions</h6>
							<p class="mb-0 text-muted">Looking for talent?</p>
						</div>
						<div class="p-3">
							<button type="button" class="btn btn-outline-success pl-4 pr-4">
								POST A JOB</button>
						</div>
					</div>
				</aside>




				<!-- ================================================================================================================================== -->

				<main th:if="${page}=='0'"
					class="col col-xl-9 order-xl-2 col-lg-12 order-lg-2 col-md-12 col-sm-12 col-12">
					<div class="box shadow-sm rounded bg-white mb-3">
						<div class="d-flex box-title border-bottom p-3">
							<h6 class="m-0 col-6 bold">거래내역</h6>
							<div class="col-4"></div>
							<button type="button" class="btn btn-light btn-sm col-2"
								th:onclick="|location.href='@{/mypage/1/1}'|">모든정보보기</button>

						</div>

						<div class="box-body p-3">
							<div>
								<table class="table table-striped">
									<thead>
										<tr>
											<th>시간</th>
											<th>상품제목</th>
											<th>판매자</th>
											<th>구매수량</th>
											<th>총 가격</th>
											<th>상태</th>
											<th>리뷰 달기</th>
										</tr>

									</thead>
									<tbody class="likepost">
										<tr th:each="order: ${orders}">
											<td th:text="${order.createdAt}"></td>
										
											
											
											<td class="titttle" th:id="${order.product_id}" th:text="${order.title}" style="cursor:pointer"></td>
											<td class="selller" th:id="${order.seller_id}" th:text="${order.nickname2}" style="cursor:pointer"></td>
											<td th:text="${order.order_qty}"></td>
											<td th:text="${order.order_price}"></td>
											<td th:text="${order.order_status}"></td>
											<td>
												<div class="container">
													<div class="row" style="margin-top: 0;">
														<div class="col-md-12">
															<div class="well well-sm">
																
																<div class="text-right" style="padding-bottom: 10px;">
																	<a class="btn btn-success btn-green open-review-box"  th:id="'open-review-box'+${order.order_id}"
																		>리뷰 작성</a>
																</div>

																<div class="row" th:id="'post-review-box'+${order.order_id}" style="display: none;">
																	<div class="col-md-12">
																		<form>
																		<div name="myform" class="myform" >
																				<fieldset>
																					<input type="radio" th:class="'rating'+${order.order_id}" name="rating" value="5"
																						th:id="'rate1'+${order.order_id}"><label th:for="'rate1'+${order.order_id}">⭐</label> <input
																						type="radio" th:class="'rating'+${order.order_id}" name="rating" value="4" th:id="'rate2'+${order.order_id}"><label
																						th:for="'rate2'+${order.order_id}">⭐</label> <input type="radio"
																						th:class="'rating'+${order.order_id}" name="rating" value="3" th:id="'rate3'+${order.order_id}"><label
																						th:for="'rate3'+${order.order_id}">⭐</label> <input type="radio"
																						th:class="'rating'+${order.order_id}" name="rating" value="2" th:id="'rate4'+${order.order_id}"><label
																						th:for="'rate4'+${order.order_id}">⭐</label> <input type="radio"
																						th:class="'rating'+${order.order_id}" name="rating" value="1" th:id="'rate5'+${order.order_id}"><label
																						th:for="'rate5'+${order.order_id}">⭐</label>
																				</fieldset> 
																			</div>
																			<input id="ratings-hidden" name="rating"
																				type="hidden">
																			<textarea class="form-control animated" cols="50"
																				th:id="'new-review'+${order.order_id}" name="comment"
																				placeholder="리뷰를 입력해주세요." rows="5"></textarea>


																			



																			<div class="text-right" style="padding-top:10px;">

																				<a class="btn btn-danger btn-lg close-review-box" th:href="@{#}"
																					th:id="'close-review-box'+${order.order_id}"
																					style="display: none; margin-right: 10px;"> <span
																					class="glyphicon glyphicon-remove"></span>Cancel
																				</a>
																				<button class="btn btn-success btn-lg review" th:id="${order.order_id}" type="button">Save</button>
																			</div>
																		</form>
																	</div>
																</div>
															</div>

														</div>
													</div>
												</div>

											</td>
										</tr>
									</tbody>

								</table>
							</div>

						</div>
					</div>
					<div class="box shadow-sm rounded bg-white mb-3">
						<div class="d-flex box-title border-bottom p-3">
							<h6 class="m-0 col-6 bold">찜한 게시물</h6>
							<div class="col-4"></div>

							<button type="button" class="btn btn-light btn-sm col-2"
								th:onclick="|location.href='@{/mypage/2/1}'|">모든정보보기</button>

						</div>
						<div class="box-body p-3">
							<div>
								<table class="table table-striped">
									<thead>
										<tr>
											<th>시간</th>
											<!-- <th>찜누른닉네임</th> -->
											<th>제목</th>
											<th>판매자</th>
										</tr>
									</thead>
									<tbody class="likepost">
									     
										<tr th:each="likepost: ${likeposts}">
											<td th:text="${likepost.createdAt}"></td>
											<!-- <td th:text="${likepost.nickname}"></td> -->
											<td class="titttle" th:id="${likepost.product_id}" th:text="${likepost.title}" style="cursor:pointer"></td>
											<td th:text="${likepost.nickname}"></td>
											<td><a class="navbar-brand" th:id="${likepost.like_id}">
											<!--<img class="heart" th:id="${likepost.like_id}" th:src="@{/images/heartheart.png}" style="width:80%;cursor:pointer" alt="">-->
											<i class="fa fa-heart heart" th:id="${likepost.like_id}" style="cursor: pointer; color:#2cdd9b;" ></i>
											</a></td>
											
											
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div class="box shadow-sm rounded bg-white mb-3">
						<div class="d-flex box-title border-bottom p-3">
							<h6 class="m-0 col-6 bold">쪽지</h6>
							<div class="col-4"></div>
							<button type="button" class="btn btn-light btn-sm col-2"
								th:onclick="|location.href='@{/mypage/3}'|">모든정보보기</button>
						</div>
						<div class="box-body p-3">
							<div>
								<table class="table table-striped">
									<thead>
										<tr>
											<th>시간</th>
											<th>보낸 사람 닉네임</th>
											<th>상품명</th>
											<th>받은 사람 닉네임</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="order: ${orders}">
											<td th:text="${order.createdAt}"></td>
											<td th:text="${order.nickname}"></td>
											<td th:text="${order.title}"></td>
											<td th:text="${order.nickname2}"></td>
										</tr>
									</tbody>

								</table>
							</div>
						</div>
					</div>

					<div class="box shadow-sm rounded bg-white mb-3">
						<div class="box-title border-bottom p-3">
							<h6 class="m-0">Education</h6>
						</div>
						<div class="box-body p-3 border-bottom">
							<div class="d-flex align-items-top job-item-header pb-2">
								<div class="mr-2">
									<h6 class="font-weight-bold text-dark mb-0">Stanford
										University</h6>
									<div class="text-truncate text-primary">Master’s
										programmes</div>
									<div class="small text-gray-500">Oct 2020 - Present (4
										year 7 month)</div>
								</div>
								<img class="img-fluid ml-auto mb-auto"
									th:src="@{/images/e1.png}" alt="">
							</div>
							<p class="mb-0">Find the most qualified people in the most
								unexpected places. Information for applicants to consider when
								applying for local positions.</p>
						</div>
						<div class="box-body p-3">
							<div class="d-flex align-items-top job-item-header pb-2">
								<div class="mr-2">
									<h6 class="font-weight-bold text-dark mb-0">Harvard
										University</h6>
									<div class="text-truncate text-primary">Maths and science
										education</div>
									<div class="small text-gray-500">Oct 2020 - Present (4
										year 7 month)</div>
								</div>
								<img class="img-fluid ml-auto mb-auto"
									th:src="@{/images/e2.png}" alt="">
							</div>
							<p class="mb-0">Wualified people in the most unexpected
								places. Information for applicants to consider when applying for
								local positions.</p>
						</div>
					</div>
				</main>

				



				<!-- ========================================================================================================== -->


			
			</div>
		</div>
	</div>
	  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script>
		$(function() {
			$(".review").click(function(e) {
				let id = e.currentTarget.id;
				var rating1 = '.rating' + id + ':checked';
				var rating2 = $(rating1).val();//내가 선택한 별점
				var content = $('#new-review' + id).val();

				console.log(id);
				console.log(rating1);
				console.log(rating2);
				console.log(content);
				if (rating2 === undefined) {
					alert('별점을 입력하세요');
				}
				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/review",
					data : {
						"order_id" : id,
						"rating" : rating2,
						"content" : content
					},
					success : function(data, textStatus) {
						if (data == 'true') {
							alert('리뷰를 등록했습니다.');
							location.reload();
						} else {
							alert('오류가 발생했습니다');

						}
					},

				});

			});
			
			
			$(".heart").click(function(e) {
				let id = e.currentTarget.id;
		
			

				console.log(id);
				
				
				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/heartremove",
					data : {
						"like_id" : id,
					},
					success : async (data, textStatus) => {
						if (data == 'true') {
							
							await swal("알림","찜하기 취소");							
							location.reload();
						} else {
							await swal("검색어를 입력해주세요.");
						}
					},
				});
			});
			
			$(".titttle").click(function(e) {
				let id = e.currentTarget.id;//포스트 아이디
			
			

				console.log(id);
				
				
				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/clicktitle",
					data : {
						"id" : id,
					},
					success : function(data, textStatus) {
						
							location.reload();
							location.replace(data)
					},

				});

			});
			
			$(".selller").click(function(e) {
				let id = e.currentTarget.id;//포스트 아이디
		
			

				console.log(id);
				
				
				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/clickname",
					data : {
						"id" : id,
					},
					success : function(data, textStatus) {
						
							location.reload();
							location.replace(data)
					},

				});

			});
			
			

		});
	</script>


</section>

</html>

