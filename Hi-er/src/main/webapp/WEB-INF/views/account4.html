<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layout}">


<section layout:fragment="contents">
	<div class="py-5">
		<div class="container">
			<div class="row">
				<!-- Main Content -->
				<aside class="col col-xl-3 order-xl-1 col-lg-12 order-lg-1 col-12">
					<div
						class="box mb-3 shadow-sm rounded bg-white profile-box text-center">
						<div class="py-4 px-3 border-bottom">
							<img class="img-fluid mt-2 rounded-circle"
								th:src="@{/upload/} + ${session.loginedUser.profile_image}"
								onerror="this.src='/images/user/default.jpg'"
								alt="Responsive image">
							<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.email
								}]]</h5>
							<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.name
								}]]</h5>
							<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.nickname
								}]]</h5>
						</div>
					
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.buyOrder}]]건</h6>
								<p class="mb-0 text-black-50 small">구매 건수</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.sellOrder}]]건</h6>
								<p class="mb-0 text-black-50 small">판매 건수</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.buySumOrder}]]원</h6>
								<p class="mb-0 text-black-50 small">구매 총가격</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.sellSumOrder}]]원</h6>
								<p class="mb-0 text-black-50 small">판매 총가격</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 border-right p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.clickLike}]]번</h6>
								<p class="mb-0 text-black-50 small">누른 좋아요</p>
							</div>
							<div class="col-6 p-3">
								<h6 class="font-weight-bold text-dark mb-1">[[${statistics.clickedLike}]]번</h6>
								<p class="mb-0 text-black-50 small">눌린 좋아요</p>
							</div>
						</div>
						<div class="d-flex">
							<div class="col-6 p-3 overflow-hidden border-top border-right">
								<a class="font-weight-bold p-2 d-block" th:href="@{/logout}">
									로그아웃 </a>
							</div>
							<div class="col-6 p-3 overflow-hidden border-top">
								<a th:if=${session.loginedUser.type}!=2
									class="font-weight-bold p-2 d-block" th:href="@{/mypage/4}">
									내정보수정 </a> <a th:unless=${session.loginedUser.type}!=2
									class="font-weight-bold p-2 d-block" th:href="@{/mypage/5}">
									내정보수정 </a>
							</div>
						</div>

					</div>
					
				</aside>






				<!-- =============================================개인정보수정================= -->
				<main th:if="${page}=='4'"
					class="col col-xl-8 order-xl-2 col-lg-12 order-lg-2 col-md-12 col-sm-12 col-12">


					<div class="box shadow-sm rounded bg-white mb-3">
						<div class="d-flex box-title border-bottom p-3">
							<h6 class="m-0 col-6">개인정보수정</h6>

						</div>

						<div class="box-body p-3">
							<div class="py-4 px-3 border-bottom d-flex">

								<div
									class="box mb-3 rounded bg-white profile-box text-center border-right">
									<form method="post" enctype="multipart/form-data"
										action="/profileImageUpdate">
										<div class="py-4 px-3">
											<img th:src="@{/images/user/s4.png}"
												class="img-fluid mt-2 rounded-circle" alt="Responsive image">
											<input id="file" name="file"
												accept="image/*" type="file"
												class="file">
										</div>
										<div class="p-4">

											<label data-toggle="tooltip" data-placement="top"
												data-original-title="Upload New Picture"
												for="profileUpdateBtn"
												class="btn btn-info m-0"> <i
												class="mdi mdi-image"></i> Upload

											</label>
											<button data-toggle="tooltip" data-placement="top"
													data-original-title="Delete" type="submit"
													id="profileUpdateBtn"
													class="btn btn-danger" style="display:none;">
												</button>

											<div style="padding-top: 10px;">
												<button data-toggle="tooltip" data-placement="top"
													data-original-title="Delete" type="submit"
													class="btn btn-danger">
													<i class="mdi mdi-delete"></i> Delete
												</button>
											</div>
										</div>
									</form>
								</div>
								<div class="col-6 p-3">
									<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.email
										}]]</h5>
									<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.nickname
										}]]</h5>
									<h5 class="font-weight-bold text-dark mb-1 mt-4">[[${session.loginedUser.name
										}]]</h5>
								</div>


							</div>
							<form class="needs-validation" novalidate="">
								<div class="form-row mt-3 ml-1 border-bottom">
									<div class="col-md-8 mb-3">
										<label for="validationCustom01">닉네임</label> <input type="text"
											class="form-control" id="validationCustom01" value="Mark"
											required="">

									</div>

									<div class="col-md-4 mb-3">

										<label for="validationCustomUsername">Username</label><br>
										<button type="button" class="btn btn-light btn-sm"
											id="validationCustom02">중복확인</button>

									</div>
									<div class="col-md-4 mb-3">


										<button class="btn btn-primary" id="nickmody" type="submit"
											disabled>닉네임 수정</button>
									</div>

								</div>
							</form>
							<form class="needs-validation" novalidate="">
								<div class="form-row mt-3 ml-1 border-bottom">
									<div class="col-md-8 mb-3">
										<label for="validationCustom01">현재 비밀번호</label> <input
											type="password" class="form-control" id="validationCustom03"
											value="" required="">

									</div>
									<div class="col-md-8 mb-3">
										<label for="validationCustom01">새 비밀번호</label> <input
											type="password" class="form-control" id="validationCustom04"
											value="" required="">

									</div>
									<div class="col-md-8 mb-3">
										<label for="validationCustom01">새 비밀번호 확인</label> <input
											type="password" class="form-control" id="validationCustom05"
											value="" required="">

									</div>

									<div class="col-md-5 mb-3">


										<button class="btn btn-primary" id="passmody" type="submit">비밀번호
											수정</button>
									</div>

								</div>
							</form>
						</div>
					</div>


				</main>




				<!-- ========================================================================================================== -->



			</div>
		</div>
	</div>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script>
		$(function() {
			$('.imgUpload').click(function() {
				$(this).next().click(); /* NEXT는 다음 형제 - img와 input태그 사이 다른 태그 넣으면 안됨 */

			});
			$(".file").change(function(event) {
				const img = $(this).prev(); /* 미리등록 */
				var reader = new FileReader();
				reader.onload = function(e) {
					img.attr("src", e.target.result); /* 이 메서드가 실행될때의 THIS는 달라지기 때문에  */
				};
				reader.readAsDataURL(event.target.files[0]);
			});

			//닉네임 중복확인
			$("#validationCustom02").click(function() {

				let nick = $('#validationCustom01').val();
				if (nick == '') {
					alert("닉네임을 입력하세요.");

					return;
				}

				console.log(nick);

				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/nickoverlap",
					data : {
						nick : $('#validationCustom01').val()
					},
					success : function(data, textStatus) {
						if (data == 'true') {
							alert('사용 불가능합니다.');
							$('#nickmody').attr('disabled', true);
						} else {
							alert('사용 가능합니다.');
							$('#nickmody').attr('disabled', false);
						}
					}
				});
			});
			//닉네임수정
			$('#nickmody').click(function() {

				let nick = $('#validationCustom01').val();
				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/nickupdate",
					data : {
						nick : $('#validationCustom01').val()
					},
					success : function(data, textStatus) {
						if (data == 'true') {
							alert('닉네임 수정을 완료했습니다');

						} else {
							alert('닉네임 수정을 실패했습니다.');

						}
					}
				});

			});

			//패스워드 수정
			$("#passmody").click(function() {
				let pass1 = $('#validationCustom03').val();
				console.log("jjj");
				if (pass1 == '') {
					alert("현재 비밀번호를 입력하세요");
					$('#validationCustom03').focus();
					return false;
				}
				let pass2 = $('#validationCustom04').val();
				if (pass2 == '') {
					alert("새 비밀번호를 입력하세요");
					$('#validationCustom04').focus();
					return false;
				}
				let pass3 = $('#validationCustom05').val();
				if (pass3 == '') {
					alert("새 비밀번호 확인을 입력하세요");
					$('#validationCustom05').focus();
					return false;
				}
				if (pass2 != pass3) {
					alert("새 비밀번호와 새 비밀번호 확인이 다릅니다");
					$('#validationCustom05').focus();
					return false;

				}

				$.ajax({
					type : "post",
					dataType : "text",
					async : false,
					url : "/passupdate",
					data : {
						pass : $('#validationCustom03').val(),
						pass2 : $('#validationCustom04').val(),
						pass3 : $('#validationCustom05').val()
					},
					success : function(data, textStatus) {
						if (data == 'true') {
							alert('패스워드가 수정되었습니다.');

						} else {
							alert('현재 비밀번호가 틀렸습니다.');

						}
					}
				});
			});

		});
	</script>


</section>

</html>

